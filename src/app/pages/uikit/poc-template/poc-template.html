<div class="template-editor-container">
    <!-- Header -->
    <div class="editor-header">
        <h1 class="title">
            <i class="pi pi-file-edit"></i>
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
        </h1>
        <div class="header-actions">
            <p-button label="Preview HTML" icon="pi pi-eye" [outlined]="!showPreview || pdfUrl" severity="secondary" (onClick)="togglePreview()"> </p-button>
            <p-button label="Preview PDF" icon="pi pi-file-pdf" [outlined]="!pdfUrl" severity="info" [loading]="isGeneratingPDF" (onClick)="generatePDF()"> </p-button>
            <p-button label="‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF" icon="pi pi-download" severity="success" [outlined]="true" (onClick)="downloadPDF()"> </p-button>
            <p-button label="‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï" icon="pi pi-upload" severity="help" [outlined]="true" (onClick)="loadTemplate()"> </p-button>
            <p-button label="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" icon="pi pi-save" severity="primary" (onClick)="saveTemplate()"> </p-button>
            <p-button label="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï" icon="pi pi-refresh" severity="warn" [outlined]="true" (onClick)="resetTemplate()"> </p-button>
        </div>
    </div>

    <!-- PDF Viewer Modal -->
    <div class="pdf-viewer-modal" *ngIf="pdfUrl" (click)="closePDFViewer()">
        <div class="pdf-viewer-content" (click)="$event.stopPropagation()">
            <div class="pdf-viewer-header">
                <h3><i class="pi pi-file-pdf"></i> ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF</h3>
                <button class="close-btn" (click)="closePDFViewer()">
                    <i class="pi pi-times"></i>
                </button>
            </div>
            <iframe [src]="pdfUrl" class="pdf-iframe"></iframe>
        </div>
    </div>

    <!-- Main Content -->
    <div class="editor-content">
        <!-- Left Panel - Variables -->
        <div class="variables-panel">
            <div class="panel-header">
                <i class="pi pi-list"></i>
                <span>‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span>
            </div>

            <div class="category-tabs">
                <p-tabs [(value)]="selectedCategory">
                    <p-tablist>
                        <p-tab *ngFor="let category of getCategories()" [value]="category"> {{ category }} </p-tab>
                    </p-tablist>

                    <p-tabpanels>
                        <p-tabpanel *ngFor="let category of getCategories()" [value]="category">
                            <div class="variables-list">
                                <div *ngFor="let variable of getVariablesByCategory(category)" class="variable-item" (click)="insertVariable(variable.key)" pTooltip="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏£‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£: {{variable.key}}" tooltipPosition="right">
                                    <div class="variable-content">
                                        <div class="variable-label">
                                            <i class="pi pi-tag"></i>
                                            {{ variable.label }}
                                        </div>
                                        <div class="variable-key">{{ variable.key }}</div>
                                        <div class="variable-example">
                                            <i class="pi pi-info-circle"></i>
                                            ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: {{ variable.exampleValue }}
                                        </div>
                                    </div>

                                    <i class="pi pi-plus-circle insert-icon"></i>
                                </div>
                            </div>
                        </p-tabpanel>
                    </p-tabpanels>
                </p-tabs>
            </div>

            <!-- Instructions -->
            <div class="instructions">
                <h4><i class="pi pi-lightbulb"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h4>
                <ol>
                    <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏£‡∏Å</li>
                    <li>‡πÉ‡∏ä‡πâ Editor ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</li>
                    <li>‡∏Å‡∏î Preview HTML ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</li>
                    <li>‡∏Å‡∏î Preview PDF ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π PDF</li>
                    <li>‡∏Å‡∏î‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF</li>
                    <li>‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï</li>
                </ol>
            </div>
        </div>

        <!-- Center Panel - Editor / Preview -->
        <div class="main-panel">
            <!-- Editor Mode -->
            <div class="editor-wrapper" *ngIf="!showPreview">
                <div class="panel-header">
                    <i class="pi pi-file-edit"></i>
                    <span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï</span>
                </div>

                <div class="editor-area">
                    <p-editor [(ngModel)]="editorData" [style]="{'height':'500px'}" (onTextChange)="onEditorTextChange()">
                        <ng-template pTemplate="header">
                            <span class="ql-formats">
                                <select class="ql-header">
                                    <option value="1">Heading 1</option>
                                    <option value="2">Heading 2</option>
                                    <option value="3">Heading 3</option>
                                    <option selected>Normal</option>
                                </select>
                                <select class="ql-font">
                                    <option selected>Sans Serif</option>
                                    <option value="serif">Serif</option>
                                    <option value="monospace">Monospace</option>
                                </select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-bold" aria-label="Bold"></button>
                                <button class="ql-italic" aria-label="Italic"></button>
                                <button class="ql-underline" aria-label="Underline"></button>
                                <button class="ql-strike" aria-label="Strike"></button>
                            </span>
                            <span class="ql-formats">
                                <select class="ql-color"></select>
                                <select class="ql-background"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-list" value="ordered" aria-label="Ordered List"></button>
                                <button class="ql-list" value="bullet" aria-label="Unordered List"></button>
                                <select class="ql-align">
                                    <option selected></option>
                                    <option value="center"></option>
                                    <option value="right"></option>
                                    <option value="justify"></option>
                                </select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-link" aria-label="Insert Link"></button>
                            </span>
                        </ng-template>
                    </p-editor>
                </div>

                <div class="editor-footer">
                    <p-message severity="info" text="üí° ‡πÉ‡∏ä‡πâ {{variable_name}} ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏£‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢ Editor ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô"> </p-message>
                </div>
            </div>

            <!-- HTML Preview Mode -->
            <div class="preview-wrapper" *ngIf="showPreview">
                <div class="panel-header">
                    <i class="pi pi-eye"></i>
                    <span>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
                </div>

                <div class="preview-area">
                    <div class="document-preview" #pdfPreview [innerHTML]="previewData"></div>
                </div>

                <div class="preview-footer">
                    <p-message severity="success" text="‚úÖ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î Preview PDF ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô PDF ‡∏´‡∏£‡∏∑‡∏≠ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢"> </p-message>
                </div>
            </div>
        </div>

        <!-- Right Panel - Preview Values -->
        <div class="settings-panel" *ngIf="showPreview">
            <div class="panel-header">
                <i class="pi pi-cog"></i>
                <span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span>
            </div>

            <div class="preview-values">
                <div *ngFor="let variable of variables" class="value-field">
                    <label>{{ variable.label }}</label>
                    <input type="text" pInputText [(ngModel)]="exampleValues[variable.key]" (ngModelChange)="updatePreview()" [placeholder]="variable.exampleValue" />
                </div>
            </div>
        </div>
    </div>
</div>
